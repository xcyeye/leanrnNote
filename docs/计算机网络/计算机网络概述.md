# 计算机网络概述



## 因特网概述

### 互联网，网络和因特网

网络 (Network) 由若干`结点`(Node)和连接这些结点的`链路`(Link）组成。

![image-20220628125836474](https://picture.xcye.xyz/image-20220628125836474.png)

多个网络还可以通过路由器互连起来，这样就构成了一个覆盖范围更大的网络，即互联网（或互连网）
因此，互联网是“网络的网络(Network of Networks)

![image-20220628125857609](https://picture.xcye.xyz/image-20220628125857609.png)

因特网 (Internet)是世界上最大的互连网络（用户数以亿计，互连的网络数以百万计)

![image-20220628130023668](https://picture.xcye.xyz/image-20220628130023668.png)



### 因特网的三个发展阶段

![image-20220628130058539](https://picture.xcye.xyz/image-20220628130058539.png)

这里需要清楚一个名词`ISP(Internet Service Provider)`因特网服务提供者，也就是提供因特网服务的厂商，比如国内的三大家，电信，联通，移动，但是除了这三家，还有中国科技网，中国教育和科研计算机网

![image-20220628130320151](https://picture.xcye.xyz/image-20220628130320151.png)

> 用户和ISP之间的关系：
>
> 用户接入ISP，首先需要用户向ISP申请和缴纳一定的费用，然后便可以从ISP中得到所需要的IP地址，因为获取到了IP地址，所以用户便能够和其他设备进行通信

#### 基于ISP的三层结构的因特网

![image-20220628130451027](https://picture.xcye.xyz/image-20220628130451027.png)

其中第一层ISP因为覆盖面积广，也被称为`因特网主干网`，器可以覆盖到国际性的区域，拥有高速链路和交换设备，第一层ISP之间是`直接互连`

第二层ISP主要是公司或者是一些机构，个人，他们只有少数的和第一层ISP相连，是第一层ISP的用户

第三层ISP是第二层ISP的用户，比如一般的校园网，企业网，无线移动用户等，而且某台PC设备也可以称为一个ISP，但是他需要购买一些调制解调器或者路由器等设备，让其他用户和此PC相连



> 从上图红色链路中可以看出，两个ISP之间或者多个ISP之间可以相互通信，比如上面的两台PC之间，会经过第三层，第二层，第一层ISP





### 因特网的组成

因特网由边缘部分和核心部分组成

边缘部分：由所有连接在因特网上的主机组成。这部分是用户直接使用的，用来进行通信（传送数据、音频或视频）和资源共享

核心部分：由大量网络和链接这些网络的路由器组成。这邮分是为边缘部分提供服务的（提供连通性和交换）。

> 路由器是因特网组成中的重要构建，是实现分组交换必不可少的设备，功能是转发收到的分组

![image-20220628132027648](https://picture.xcye.xyz/image-20220628132027648.png)

## 三种交换方式

### 电路交换(电话举例)

电话交换机接通电话线的方式称为电路交换，从通信资源的分配角度来看，交换(Switching)就是按照某种方式动态地分配传输线路的资源

![image-20220628132407130](https://picture.xcye.xyz/image-20220628132407130.png)

> 电路交换就是两个设备之间需要通信，就需要先简历他们之间的链接



#### 三步

1. 建立连接(分配通信资源)
2. 通话(一直占用通信资源)
3. 释放连接(归还通信资源)

![image-20220628132615270](https://picture.xcye.xyz/image-20220628132615270.png)

> 当使用电路交换来传送计算机数据时，其线路的传输效率往往很低，这种交换方式已经淘汰了，现在更多的是使用分组交换



### 分组交换

> 在分组交换中，最重要的设备是`路由器`，它负责将各种网络互连起来，并对接收到的分组进行转发，也就是进行分组交换



#### 过程

![image-20220628133115949](https://picture.xcye.xyz/image-20220628133115949.png)

比如这里，H6和H2设备需要进行通信，H6需要将报文传输到H2

> 报文：将发送的消息的整块数据称为报文

1. 首先会将报文分成一个个等长的数据段，然后在每个数据段的前面加上一些有必要的控制信息组成`首部`，就构成了一个`分组`，也称为一个`包`，首部也可以称为包头

    ![image-20220628133334347](https://picture.xcye.xyz/image-20220628133334347.png)

    > 添加首部的作用是什么？
    >
    > 首部中包含了目的地址
    >
    > 在上面的中一个有三个分组，忽略`....`中的分组

2. 分组交换机收到一个分组后，会先将分组保存下来，然后检查器首部，根据首部中的`目的地址`进行查表转发，找到合适的转发接口，然后通过该转发接口将分组转发给下一个分组交换机

    ![image-20220628134007473](https://picture.xcye.xyz/image-20220628134007473.png)

    > 因为互联网是非常复杂的，而且一个报文会被切割成多个分组，这些分组在互联网链路中的传输路径并不都是一样的，他们最终都是到达目的地址(分组可能会存在被路由交换机丢弃的情况)

3. 主机H2收到这些分组后，去掉他们的头部，将数据段组成原始的报文

    ![image-20220628134339923](https://picture.xcye.xyz/image-20220628134339923.png)

    > 这里没有考虑其他的问题，比如分组被丢弃，分组到达目的主机时，分组乱序等情况



从上面的分组交换过程中可以看出，实现分组交换一共有三个角色参与

![image-20220628134535907](https://picture.xcye.xyz/image-20220628134535907.png)

- 发送方：构造分组，发送分组
- 路由器：缓存分组，转发分组
- 接收方：接收分组，还原报文

> 分组交换对`报文`大小有限制

### 报文交换

报文交换主要用于早期的电报通信网，和分组交换类似，报文交换同样采用存储转发方式，但是其对报文的大小没有限制，所以也就需要路由器拥有加大的缓存空间





### 三种交换方式对比

![image-20220628135207280](https://picture.xcye.xyz/image-20220628135207280.png)

![image-20220628135223714](https://picture.xcye.xyz/image-20220628135223714.png)



#### 电路交换

- 优点

    通信时延小：通信双方通信时，需要建立链接，直接交换数据

    有序传输：通信双方只在一条链路上传输，不存在失序问题

    没有冲突：通信双方拥有不同的信道，不存在争用物理信道问题

    通用范围广：电路交换既适用于传输模拟信号，也适合传输数据信号

    实时性强：主要是因为通信时延小

- 缺点

    线路独占，使用效率低：电路交换一旦建立连接，物理通路就被通信双方占用，即使通信线路空闲，也不能供其他用户使用

    灵活性差：只要建立链接的物理通过上出现故障，就必须重新建立连接



#### 报文交换

- 优点

    动态分配线路：将报文发送给节点交换机时，节点交换机会存储报文，然后选择一条合适的空闲电路，将报文发送出去

    提高线路可靠性：如果传输的某条电路出现故障，会重新选择另一条电路传输数据

    提高线路利用率：通信双方不是固定占用一条通信线路，而是在不同时间分段占用物理线路

    提供多目标服务：一个报文可以同时发送给多个目的地址

- 缺点

    转发时延：因为节点交换机会存储报文

    需要传输额外信息量：因为需要传输目的地址等信息





## 计算机网络的定义和分类

![image-20220628141132022](https://picture.xcye.xyz/image-20220628141132022.png)

> Tip
>
> 路由器后面有多个接口，其中的`WAN`就表示广域网，`LAN`表示局域网



## 计算机网络的性能指标

计算机网络的性能指标主要有以下8个

- 速率
- 带宽
- 吞吐量
- 时延
- 时延带宽积
- 往返时间
- 利用率
- 丢包率



### 速率

![image-20220628162510717](https://picture.xcye.xyz/image-20220628162510717.png)

![image-20220628162720732](https://picture.xcye.xyz/image-20220628162720732.png)



### 带宽

![image-20220628162916767](https://picture.xcye.xyz/image-20220628162916767.png)

比如我们路由是450M的，那么他就是这里所说的带宽，只是指的是出口带宽，正确的描述是`出口带宽为450Mbs`，读作450兆比特每秒



### 吞吐量

吞吐量表示在`单位时间内通过某个网络 (或信道、接口）的数据量`

吞吐量被经常用于对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络。

吞吐量受网络的带宽或额定速率的限制

![image-20220628163329776](https://picture.xcye.xyz/image-20220628163329776.png)

比如对于上面的网络来说，他们的吞吐量为700Mb/s，虽然路由的带宽为1Gb/s



### 时延

时延由三部分组成：

1. 发送时延
2. 传播时延
3. 处理时延

![image-20220628164325497](https://picture.xcye.xyz/image-20220628164325497.png)



- 发送时延：源主机将分组发往传输线路需要花费的时间

    ![image-20220628163859851](https://picture.xcye.xyz/image-20220628163859851.png)

- 传播时延：代表分组的电信号在链路上传输花费的时间(也就是在介质间的传播时间，不同的介质，传播时间不同)

    ![image-20220628163926294](https://picture.xcye.xyz/image-20220628163926294.png)

    - 处理时延：路由器收到分组后对其进行存储转发的时间

        ![image-20220628164027546](https://picture.xcye.xyz/image-20220628164027546.png)





> 源主机和目的主机之间的路径会由多段链路和多个路由器构成，所以在一条完整的通信线路上，会存在多个传播时延和多个处理时延，但是只会存在一个发送时延

![image-20220628164118987](https://picture.xcye.xyz/image-20220628164118987.png)



#### 发送时延计算



![image-20220628164511719](https://picture.xcye.xyz/image-20220628164511719.png)

 在发送报文的过程中，需要三个设备，分别是电脑网卡，信道带宽(介质)，交换机

![image-20220628164657587](https://picture.xcye.xyz/image-20220628164657587.png)

比如上面的例子

1. 对于1，因为网卡的发送速率，信道的带宽和交换机的接口速率都是1Gb/s，理论上发送速率为1Gb/s
2. 对于2，因为网卡的发送速率只有100Mb/s，所以他的发送速率只有100Mb/s
3. 3和2的情况一样

> 所以一定要保证各设备间和传输介质之间的速率匹配，如果速率不匹配，会发挥不出设备的极限性能



#### 传播时延

![image-20220628165140974](https://picture.xcye.xyz/image-20220628165140974.png)



#### 处理时延

处理时延没有固定的计算公式，传输信息是动态变化的，而且路由器的硬件指标也是不同





#### 发送时延主导还是传播时延占主导？

![image-20220628165541713](https://picture.xcye.xyz/image-20220628165541713.png)

> 所以判断哪个占主导的时候，应该具体问题具体分析 





### 时延带宽积

时延带宽积指的是时延速率和带宽的乘积，这里使用传播时延的速率

![image-20220628170011030](https://picture.xcye.xyz/image-20220628170011030.png)

### 往返时间

许多情况下，因特网上的信息不仅仅单方向传输，而且还是双向交互，所以`RTT(Round-Trip Time)`往返时间也是一个重要的性能指标

![image-20220628170632299](https://picture.xcye.xyz/image-20220628170632299.png)

### 利用率

![image-20220628170644251](https://picture.xcye.xyz/image-20220628170644251.png)

> 根据排队论，当某信道的利用率增大时，该信道引起的时延也会迅速增大，所以`信道利用率并不非越大越好`



![image-20220628170820431](https://picture.xcye.xyz/image-20220628170820431.png)



### 丢包率

丢包率也称为分组丢包率，是指`在一定的时间范围内，传输过程中丢失的分组数量与总分组数量的比率`

丟包率具体可分为：

- 接口丢包率
- 结点丢包率
- 链路丢包率
- 路径去包率
- 网络丟包率等。



> 丢包率是网络运维人员比较关心的一个网络性能指标



#### 误码

分组在传输过程中出现`误码`，被路由器直接丢弃

![image-20220628171419988](https://picture.xcye.xyz/image-20220628171419988.png)

> 注意是在传输过程中出现误码，被路由器丢弃



#### 网络拥塞

分组到达一台队列已满的分组交换机时被丢弃，在通信量较大时可能造成`网络拥塞`

> 例如一台路由器，他的存储空间已满，不能在存储其他的分组信息，所以会被丢弃，但是一般路由器都有自己的算法，在存储空间快满的时候，就将一些分组丢弃



根据网络的拥塞情况可以推断出丢包率：

1. 无拥塞时路径丢包率为0
2. 轻度拥塞时路径丢包率为1%~4%
3. 严重拥塞时路径丢包率为5%~15%









